---
title: "Project3"
author: "Yuzhi Li and Annie Brinza"
date: "2022-11-10"
output: html_document
params:
  channel: "data_channel_is_lifestyle"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(caret)
```

# **Introduction**

# **Data**
The first step we need to take is reading in the data. Then we will need to 
subset to our channel of interest. In this case, that channel is `params$channel`.

```{r read_data}
df <- read_csv("data/OnlineNewsPopularity.csv", show_col_types = FALSE)
channel_df <- df %>% 
  filter(data_channel_is_lifestyle == 1) %>% 
  select(-starts_with("data_channel_is"))
```


# **Summarizations**
In this section, we will produce some basic yet meaningful summary statistics and
plots about the training data we're working with. We will focus most closely on how
our data relates to the shares variable.

First, we will investigate the distribution of shares. This is important to understand
so all additional investigations can be contextualized. There will likely be
some outliers representing articles that went viral, resulting in a graph with a 
long right tail.

```{r share_distribution, message = FALSE, error = FALSE, warning = FALSE}
g <- ggplot(channel_df, aes(x = shares))
g + geom_histogram(fill = "mediumseagreen") + ggtitle("Distribution of Shares")
```


Now that we know the general shape of the distribution of shares, we will look 
into title length. The length of a title can affect whether someone
is willing to share an article, since if the title gets cut off when sharing, a 
person might be less likely to share. This could differ by channel. In the summary
below, pay attention to the average title length and see how it differs from the
other channels. 

```{r summary_1}
summary(channel_df$n_tokens_title)
```

To continue this investigation, we will plot title length against shares. If there
is a negative downward trend, that means the longer the title length, the less likely
a person is to share. If there is a positive upward trend, that means the longer
the title length, the more likely a person is to share. Check for outliers as well 
- see where they land on spectrum of title length. Those represent viral articles.

```{r graph_1}
g <- ggplot(channel_df, aes(x = n_tokens_title, y = shares))
g + geom_point() + xlab("Title Length") + ggtitle("Shares vs Title Length")
```
Next, we will investigate the length of the article itself. Compare the mean of
the article length across channels - do you see one where the articles are typically
longer?

```{r summary_2}
summary(channel_df$n_tokens_content)
```

We will plot the length of the content vs shares on a scatter plot. Once more, check
to see what the trend looks like. If it is a positive upward trend, then longer articles
will result in more shares. If it is a negative downward trend, then longer articles
will result in fewer shares. If it looks like a flat line, then article length doesn't
really affect shares. Once again, look for outliers. Those represent articles that
went viral - see where they tend to land when it comes to content length.

```{r graph_2}
g <- ggplot(channel_df, aes(x = n_tokens_content, y = shares))
g + geom_point() + xlab("Content Length") + ggtitle("Shares vs Content Length")
```
Now that we've investigated how length affects shares, we will dive into the actual
content of the article. First, we will look at how videos affect shares. In the summary,
compare the average number of videos to those of other channels to see which has the
most videos associated with the content. If the median is 0 but there is an average,
that means the majority of articles from this channel do not have any videos.

```{r summary_3}
summary(channel_df$num_videos)
```

Now we will see how the videos affect shares using a scatter plot. If there is a
positive upward trend, more videos in an article will result in more shares.
If there is a negative downward trend, more videos in an article will result in 
fewer shares.

```{r graph_3}
g <- ggplot(channel_df, aes(x = num_videos, y = shares))
g + geom_point() + xlab("Video Count") + ggtitle("Shares vs Video Count")
```



# **Modeling**
In order to do some modeling, first we will need to split the data into a training
and test set. First, we will remove URLs since they are just essentially IDs for
the articles.
```{r split_data}
# Setting seed for reproducibility
set.seed(24)
channel_df <- channel_df %>% select(-url)
train_index <- createDataPartition(channel_df$shares, p = 0.70, list = FALSE, times = 1)
train <- channel_df[train_index, ]
test <- channel_df[-train_index, ]
```

## Linear Regression Models

## Random Forest Model
In this section, we will fit a random forest model. Random forest models are an ensemble
model, using regression trees and a subset of predictors for each tree. They are an
extension of bagging models, where the algorithm resamples from the data, trains
a tree on this resample, and then calculates the prediction. This is done B times,
where B is generally a large number. The final predictions are then an average from
all of the trees. Random forest models do the same thing, except each tree only
uses a subset of predictors in order to reduce correlation amongst trees and thus
reduce variance.

```{r random_forest}
fit_rf <- train(shares ~., data = train, method = "rf", trControl = 
                   trainControl(method = "cv", number = 10), preProcess = 
                   c("center", "scale"))
```


# **Comparison**